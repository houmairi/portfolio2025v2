---
import { Copy, Check, Menu, X } from '@lucide/astro';
---

<div id="navbar" class="header sticky top-0 z-40 backdrop-blur bg-white/20 transition-transform duration-300">
  <nav class="flex items-center justify-between py-4">
    <a href="/" style="font-family: 'Satoshi', sans-serif;" class="text-xl font-medium text-neutral-800">arjun bhogal</a>
    
    <!-- Desktop Nav -->
    <div class="hidden md:flex space-x-6">
      <a href="/work" style="font-family: 'Satoshi', sans-serif;" class="text-neutral-800 text-xl font-medium hover:text-neutral-600 transition-colors">work</a>
      <a href="/#about" style="font-family: 'Satoshi', sans-serif;" class="text-neutral-800 text-xl font-medium hover:text-neutral-600 transition-colors">about</a>
      <a href="/assets/Bhogal_Arjun_CV.pdf" style="font-family: 'Satoshi', sans-serif;" class="text-neutral-800 text-xl font-medium hover:text-neutral-600 transition-colors">cv</a>
    </div>
    
    <!-- Desktop Email Copy Button -->
    <div class="hidden md:flex items-center space-x-2 bg-neutral-800 hover:bg-neutral-700 transition-colors px-4 py-2 rounded-3xl cursor-pointer group" id="copyEmailBtn">
      <span style="font-family: 'Satoshi', sans-serif;" class="text-white text-lg font-medium">arjun@bhogal.at</span>
      <Copy stroke-width="3" class="text-white w-4 h-4 group-hover:scale-110 transition-transform" id="copyIcon" />
      <Check stroke-width="3" class="text-white w-4 h-4 hidden" id="checkIcon" />
    </div>

    <!-- Mobile Menu Button -->
    <button id="mobileMenuBtn" class="md:hidden p-2 rounded-lg hover:bg-neutral-100 transition-colors">
      <Menu class="w-6 h-6 text-neutral-800" id="menuIcon" />
      <X class="w-6 h-6 text-neutral-800 hidden" id="closeIcon" />
    </button>
  </nav>
</div>

<!-- Mobile Menu Overlay -->
<div id="mobileMenu" class="fixed inset-0 bg-white md:hidden" style="z-index: 9999; transform: translateX(100%);">
  <div class="flex flex-col h-full">
    <!-- Mobile Menu Header -->
    <div class="flex items-center justify-between py-4 px-4 border-b border-neutral-200">
      <span style="font-family: 'Satoshi', sans-serif;" class="text-xl font-medium text-neutral-800">Menu</span>
      <button id="closeMobileMenu" class="p-2 rounded-lg hover:bg-neutral-100 transition-colors">
        <X class="w-6 h-6 text-neutral-800" />
      </button>
    </div>

    <!-- Mobile Menu Links -->
    <div class="flex-1 flex flex-col justify-center space-y-8 px-8">
      <a href="/work" style="font-family: 'Satoshi', sans-serif;" class="mobile-nav-link text-4xl font-medium text-neutral-800 hover:text-neutral-600 transition-colors py-4">
        work
      </a>
      <a href="/#about" style="font-family: 'Satoshi', sans-serif;" class="mobile-nav-link text-4xl font-medium text-neutral-800 hover:text-neutral-600 transition-colors py-4">
        about
      </a>
      <a href="/assets/Bhogal_Arjun_CV.pdf" style="font-family: 'Satoshi', sans-serif;" class="mobile-nav-link text-4xl font-medium text-neutral-800 hover:text-neutral-600 transition-colors py-4">
        cv
      </a>
    </div>

    <!-- Mobile Email Section -->
    <div class="px-8 pb-12">
      <div class="bg-neutral-800 hover:bg-neutral-700 transition-colors px-6 py-4 rounded-2xl cursor-pointer group w-full" id="copyEmailBtnMobile">
        <div class="flex items-center justify-between">
          <div>
            <p style="font-family: 'Satoshi', sans-serif;" class="text-white text-sm font-medium mb-1">Get in touch</p>
            <p style="font-family: 'Satoshi', sans-serif;" class="text-white text-lg font-medium">arjun@bhogal.at</p>
          </div>
          <div class="flex items-center">
            <Copy stroke-width="3" class="text-white w-5 h-5 group-hover:scale-110 transition-transform" id="copyIconMobile" />
            <Check stroke-width="3" class="text-white w-5 h-5 hidden" id="checkIconMobile" />
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    console.log('Header script loaded'); // Debug
    
    const email = 'arjun@bhogal.at';
    
    // Desktop Elements
    const copyBtn = document.getElementById('copyEmailBtn');
    const copyIcon = document.getElementById('copyIcon');
    const checkIcon = document.getElementById('checkIcon');
    
    // Mobile Elements
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    const closeMobileMenu = document.getElementById('closeMobileMenu');
    const menuIcon = document.getElementById('menuIcon');
    const closeIcon = document.getElementById('closeIcon');
    const copyBtnMobile = document.getElementById('copyEmailBtnMobile');
    const copyIconMobile = document.getElementById('copyIconMobile');
    const checkIconMobile = document.getElementById('checkIconMobile');
    const mobileNavLinks = document.querySelectorAll('.mobile-nav-link');

    console.log('Elements found:', { 
      mobileMenuBtn, 
      mobileMenu, 
      closeMobileMenu 
    }); // Debug

    // Mobile Menu Functions
    function openMobileMenu() {
      console.log('Opening mobile menu'); // Debug
      if (mobileMenu) {
        mobileMenu.style.transform = 'translateX(0)';
        mobileMenu.style.transition = 'transform 0.3s ease-in-out';
        menuIcon.classList.add('hidden');
        closeIcon.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }
    }

    function closeMobileMenuFn() {
      console.log('Closing mobile menu'); // Debug
      if (mobileMenu) {
        mobileMenu.style.transform = 'translateX(100%)';
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        document.body.style.overflow = '';
      }
    }

    // Copy Email Functions
    async function copyEmail(isMobile = false) {
      const copyIconEl = isMobile ? copyIconMobile : copyIcon;
      const checkIconEl = isMobile ? checkIconMobile : checkIcon;
      
      try {
        await navigator.clipboard.writeText(email);
        
        copyIconEl.classList.add('hidden');
        checkIconEl.classList.remove('hidden');
        
        setTimeout(() => {
          checkIconEl.classList.add('hidden');
          copyIconEl.classList.remove('hidden');
        }, 3000);
        
      } catch (err) {
        console.error('Failed to copy email: ', err);
      }
    }

    // Event Listeners
    mobileMenuBtn?.addEventListener('click', () => {
      console.log('Mobile menu button clicked'); // Debug
      openMobileMenu();
    });
    
    closeMobileMenu?.addEventListener('click', () => {
      console.log('Close button clicked'); // Debug
      closeMobileMenuFn();
    });
    
    copyBtn?.addEventListener('click', () => copyEmail(false));
    copyBtnMobile?.addEventListener('click', () => copyEmail(true));
    
    // Close menu when clicking on links
    mobileNavLinks.forEach(link => {
      link.addEventListener('click', closeMobileMenuFn);
    });

    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeMobileMenuFn();
      }
    });

    // Hide/Show navbar on scroll
    let lastScroll = 0;
    const nav = document.getElementById('navbar');

    window.addEventListener('scroll', () => {
      const currentScroll = window.pageYOffset;

      if (currentScroll <= 0) {
        nav.style.transform = 'translateY(0)';
        return;
      }

      if (currentScroll > lastScroll) {
        nav.style.transform = 'translateY(-100%)';
      } else {
        nav.style.transform = 'translateY(0)';
      }

      lastScroll = currentScroll;
    });
  });
</script>